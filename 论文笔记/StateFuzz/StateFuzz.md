# Abstract

ç°æœ‰çš„è¦†ç›–ç‡å¼•å¯¼Fuzzeré€šå¸¸å€¾å‘äºä½¿ç”¨è§¦å‘æ–°ä»£ç çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ”¾å¼ƒä½¿ç”¨è§¦å‘ä»¥å¾€ç›¸åŒä»£ç çš„æµ‹è¯•æ¡ˆä¾‹ã€‚ ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯æœ€ä¼˜çš„åšæ³•ï¼Œä½¿ç”¨ç›¸åŒä»£ç çš„æ–°æµ‹è¯•ç”¨ä¾‹å¯èƒ½æ¯”ä»¥å‰çš„æµ‹è¯•ç”¨ä¾‹æ›´å¥½ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šè§¦å‘å¯¹ä»£ç æ¢ç´¢å’Œé”™è¯¯ï¼Œä»è€Œå‘ç°æœ‰ç”¨çš„æ–°ç¨‹åºçŠ¶æ€ã€‚ 

StateFuzzæ€è·¯ï¼šä½¿ç”¨é™æ€åˆ†ææ¥è¯†åˆ«ç›®æ ‡ç¨‹åºçŠ¶æ€å˜é‡çš„å€¼ï¼Œç„¶åå¯¹ç›®æ ‡ç¨‹åºè¿›ç¨‹æ’æ¡©ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿½è¸ªè¿™äº›å€¼æ¥æ„å»ºç¨‹åºçŠ¶æ€ã€‚æœ€åä½¿ç”¨è¿™äº›çŠ¶æ€ä¿¡æ¯å¯¹èƒ½è§¦å‘æ–°çŠ¶æ€çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæ’åºï¼Œå¹¶ä½¿ç”¨äº†ä¸‰ç»´åé¦ˆæœºåˆ¶å¾®è°ƒè¦†ç›–å¼•å¯¼Fuzzerçš„è¿›åŒ–æ–¹å‘ã€‚ 

å®ç°äº†StateFuzzçš„åŸå‹ï¼Œå¹¶åœ¨Linuxä¸Šæ¸¸é©±åŠ¨ç¨‹åºå’ŒAndroidé©±åŠ¨ç¨‹åºä¸Šè¿›è¡Œäº†è¯„ä¼°ã€‚è¯„ä¼°ç»“æœè¡¨æ˜ï¼ŒStateFuzzå¯ä»¥æœ‰æ•ˆåœ°å‘ç°æ–°ä»£ç å’Œæ¼æ´ã€‚å®ƒå‘ç°äº†18ä¸ªæœªçŸ¥æ¼æ´å’Œ2ä¸ªå·²çŸ¥ä½†æœªä¿®è¡¥çš„æ¼æ´ï¼Œä¸æœ€å…ˆè¿›çš„æ¨¡ç³Šå™¨Syzkallerç›¸æ¯”ï¼Œä»£ç è¦†ç›–ç‡å’ŒçŠ¶æ€è¦†ç›–ç‡åˆ†åˆ«æé«˜äº†19%å’Œ32%ã€‚

# Introduction

Limitationsï¼š

ä»¥ä»£ç è¦†ç›–ç‡ä¸ºæ ¸å¿ƒï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å¯¹ç¨‹åºå…¶ä»–åé¦ˆä¸æ•æ„Ÿã€‚å®é™…ä¸Šï¼Œå¤§é‡ç¨‹åºï¼ˆåŒ…æ‹¬è®¾å¤‡é©±åŠ¨ç¨‹åºå’Œç½‘ç»œæœåŠ¡ç­‰ï¼‰å…·æœ‰å¤æ‚çš„å†…éƒ¨ç¨‹åºçŠ¶æ€ï¼Œå¦‚æœæœªè¾¾åˆ°ç‰¹å®šçŠ¶æ€ï¼Œåˆ™ä¸ä¼šç»§ç»­æ‰§è¡Œæˆ–å´©æºƒã€‚

ä¸€äº›æ¢ç´¢ç¨‹åºçŠ¶æ€çš„Fuzzerï¼š

- IJONï¼šä½¿ç”¨ä¸åŒå½¢å¼çš„æ‰‹åŠ¨æ ‡è®°çŠ¶æ€è¡¨ç¤ºï¼› 
- InsvCovï¼šä½¿ç”¨ç¨‹åºçš„å¯èƒ½ä¸å˜é‡ä½œä¸ºè¾¹ç•Œæ¥åˆ’åˆ†ç¨‹åºçŠ¶æ€ç©ºé—´ï¼›
- AFLNetï¼šä½¿ç”¨æœåŠ¡å™¨çš„å“åº”ä»£ç ä½œä¸ºç¨‹åºçŠ¶æ€æ¥é©±åŠ¨ç½‘ç»œåè®®æ¨¡ç³ŠåŒ–ï¼›
- StateAFLï¼šé€šè¿‡å¯¹ç‰¹å®šè¿›ç¨‹å†…å­˜æ‰§è¡Œä½ç½®æ•æ„Ÿçš„å“ˆå¸Œæ¥è¯†åˆ«ç¨‹åºçŠ¶æ€ã€‚ 

åœ¨å¼€å‘çŠ¶æ€æ„ŸçŸ¥æ¨¡ç³Šè§£å†³æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š

1. what are program states?

   ä¸€èˆ¬æ¥è¯´å°±æ˜¯ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç¨‹åºå˜é‡ã€å†…å­˜å’Œå¯„å­˜å™¨çš„å€¼ã€‚ä½†æ˜¯ç”±äºæ•°é‡åºå¤§ï¼Œéš¾ä»¥äº‹ä»¶ä¸­å®Œå…¨è¿½è¸ªè¿™äº›çŠ¶æ€ï¼Œã€‚å¿…é¡»å…³æ³¨é‚£äº›å¯¹Fuzzingèµ·è‡³å…³é‡è¦çš„çŠ¶æ€å­é›†ï¼Œä»¥åŠå¦‚ä½•å‡å°‘çŠ¶æ€ç©ºé—´ã€‚

2. how to recognize program states and track them during fuzzing?

   åˆ—ä¸¾äº†ä»¥ä¸Šå‡ ç§çŠ¶æ€Fuzzerå®šä¹‰çš„çŠ¶æ€ã€‚

3. how to utilize program states to guide fuzzing?

   IJONç”¨æ‰‹åŠ¨æ³¨é‡Šçš„çŠ¶æ€è¦†ç›–æ¥æ›¿æ¢AFLçš„bitmapsï¼›AFLNetè¿½è¸ªçŠ¶æ€è½¬æ¢ï¼Œå¹¶ç»“åˆä»£ç è¦†ç›–ç‡ï¼Œç”¨ä¸€ä¸ªæ–°çš„ç§å­è¯­æ–™åº“å­˜å‚¨å‘ç°æ–°çŠ¶æ€çš„æµ‹è¯•ç”¨ä¾‹ã€‚

StateFuzzå®šä¹‰çš„çŠ¶æ€å˜é‡ç‰¹å¾ï¼š

1. é•¿çš„ç”Ÿå­˜å‘¨æœŸ
2. å¯ä»¥è¢«ç”¨æˆ·æ›´æ–°
3. å¯ä»¥å½±å“ç¨‹åºçš„æ§åˆ¶æµæ´»å†…å­˜è®¿é—®æŒ‡é’ˆ

è¿™äº›çŠ¶æ€å˜é‡çš„å€¼ç»„åˆæˆç¨‹åºçŠ¶æ€ï¼Œæ˜¯ä¸€ç§ç²—ç²’åº¦çš„çŠ¶æ€ã€‚

ä¸ºäº†æœ‰æ•ˆåœ°è·Ÿè¸ªç¨‹åºçŠ¶æ€ï¼Œæˆ‘ä»¬å‡å°‘äº†ç¨‹åºçŠ¶æ€ç»„æˆä¸­ä½¿ç”¨çš„çŠ¶æ€å˜é‡çš„æ•°é‡ä»¥åŠæ¯ä¸ªçŠ¶æ€å˜é‡çš„å€¼ç©ºé—´ï¼š

1. ç”¨ç›¸å…³çš„çŠ¶æ€å˜é‡å¯¹ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çŠ¶æ€å˜é‡çš„ç»„åˆæ¥å»ºæ¨¡ç¨‹åºçŠ¶æ€ï¼›
2. å¯¹äºæ¯ä¸ªçŠ¶æ€å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å®ƒå¯èƒ½é‡‡ç”¨çš„ä¸€ç»„å€¼ï¼ˆæˆ–å€¼èŒƒå›´ï¼‰ï¼Œå…¶ä¸­ä¸åŒçš„å€¼é€‰æ‹©ä»£è¡¨ä¸åŒçš„çŠ¶æ€ï¼›
3. å°†æ¯ä¸ªçŠ¶æ€å˜é‡çš„å€¼ç©ºé—´åˆ’åˆ†ä¸ºå‡ ä¸ªèŒƒå›´ï¼Œå¹¶è·Ÿè¸ªåœ¨Fuzzingè¿‡ç¨‹ä¸­æ˜¯å¦å‘½ä¸­è¿™äº›èŒƒå›´ã€‚

è®¾è®¡äº†ä¸‰ç»´å¼•å¯¼æœºåˆ¶ï¼š

1. ä»£ç è¦†ç›–ç‡
2. è‹¥è¾“å…¥å¯ä»¥åå­—ä¸¤ä¸ªå˜é‡çš„æ–°å€¼èŒƒå›´ç»„åˆï¼Œä¸”è¿™ä¸¤ä¸ªå˜é‡éƒ½åœ¨ç›¸å…³çš„çŠ¶æ€å˜é‡å¯¹ä¸­ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªè¾“å…¥æ˜¯interestingçš„ï¼›
3. è‹¥è¾“å…¥æ”¹å˜äº†çŠ¶æ€å˜é‡çš„ä¸Šä¸‹é™ï¼Œä¹Ÿè®¤ä¸ºæ˜¯interestingçš„ã€‚å½“ä¸Šä¸€ä¸ªå¼•å¯¼å¤±æ•ˆæ—¶ï¼Œæ­¤å¼•å¯¼ä»é€‚ç”¨ï¼Œå¦‚å½“æ— æ³•ç¡®å®šçŠ¶æ€å˜é‡çš„å€¼èŒƒå›´æ—¶ã€‚

Contributionï¼š

- ä¸ºçŠ¶æ€å¯Œè£•çš„ç¨‹åºï¼ˆå¦‚é©±åŠ¨ç¨‹åºï¼‰æå‡ºäº†ä¸€ç§æ–°çš„æ¨¡ç³ŠåŒ–è§£å†³æ–¹æ¡ˆStateFuzzï¼Œä»¥é€šè¿‡å°†ç¨‹åºçŠ¶æ€ä½œä¸ºåé¦ˆæ¥æé«˜æ¨¡ç³ŠåŒ–æ•ˆç‡ï¼›
- æå‡ºç”¨çŠ¶æ€å˜é‡å»ºæ¨¡ç¨‹åºçŠ¶æ€ï¼Œå¹¶ä½¿ç”¨é™æ€åˆ†æå’Œç¬¦å·æ‰§è¡Œè‡ªåŠ¨è¯†åˆ«çŠ¶æ€ï¼›
- è®¾è®¡ä¸€ç§æ–°çš„ä¸‰ç»´åé¦ˆæœºåˆ¶ï¼Œå¸®åŠ©æ¨¡ç³Šå™¨æœ‰æ•ˆåœ°æ¢ç´¢ç¨‹åºçŠ¶æ€ï¼ŒåŒæ—¶å¢åŠ ä»£ç è¦†ç›–ç‡ï¼›
- å®ç°äº†ä¸€ä¸ªStateFuzzåŸå‹ï¼Œå¹¶åœ¨å®é™…é©±åŠ¨ç¨‹åºä¸Šè¿›è¡Œäº†è¯„ä¼°ï¼Œå‘ç°äº†é©±åŠ¨ç¨‹åºä¸­çš„18ä¸ªæ–°æ¼æ´ï¼ŒåŒæ—¶å®ç°äº†æ¯”ç°æœ‰æ–¹æ³•æ›´é«˜çš„ä»£ç è¦†ç›–ç‡ã€‚ 



# MOTIVATION

## Example

è¦†ç›–ç‡å¼•å¯¼çš„Fuzzerå°†å¿½ç•¥ä½¿ç”¨ç›¸åŒä»£ç è·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå³ä½¿å®ƒä»¬å·²ç»æ¢ç´¢äº†æ–°çŠ¶æ€ï¼Œå¹¶ä¸”å¾ˆéš¾å‘ç°ä¾èµ–äºæ–°çŠ¶æ€çš„æ–°ä»£ç æˆ–æ¼æ´ã€‚å› æ­¤ï¼Œåœ¨æ¨¡ç³ŠåŒ–è¿‡ç¨‹ä¸­æ¢ç´¢ç¨‹åºçŠ¶æ€å¹¶å¯¹è§¦å‘æ–°çŠ¶æ€çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œä¼˜å…ˆçº§æ’åºæ˜¯è‡³å…³é‡è¦çš„ï¼Œå³ä½¿å®ƒä»¬å¯èƒ½ä¸ä¼šè§¦å‘æ–°ä»£ç ã€‚ 

## ç¨‹åºçŠ¶æ€

ç¨‹åºçŠ¶æ€æ˜¯ç”±ç¨‹åºç»´æŠ¤çš„ç‰¹å®šæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç”¨äºè®°ä½ä¹‹å‰çš„äº‹ä»¶æˆ–ç”¨æˆ·äº¤äº’ã€‚

æ–‡ç« ä»åŒ…å«å…³é”®å­—â€œstate machineâ€çš„å¼€æºé¡¹ç›®ä¸­æ”¶é›†äº†50ä¸ªä»£ç Commitï¼Œè¿™è¡¨æ˜ç¨‹åºæ­£åœ¨å¤„ç†æŸäº›çŠ¶æ€ã€‚ ç»“æœè¡¨æ˜ï¼Œåœ¨50æ¬¡æäº¤ä¸­ï¼Œæœ‰48æ¬¡æäº¤çš„çŠ¶æ€ç”±å¸ƒå°”/æ•´æ•°æˆ–æšä¸¾ç±»å‹çš„å˜é‡è¡¨ç¤ºï¼›å¯¹äºå…¶ä»–ä¸¤ä¸ªæäº¤ï¼Œä¸€ä¸ªä½¿ç”¨å‡½æ•°æŒ‡é’ˆè¡¨ç¤ºçŠ¶æ€ï¼Œå¦ä¸€ä¸ªä½¿ç”¨åŒ…ä¸­çš„çŠ¶æ€ä»£ç è¡¨ç¤ºçŠ¶æ€ã€‚ å› æ­¤å¯ä»¥åˆ©ç”¨åŒ…å«å…³é”®ä¿¡æ¯çš„å˜é‡æ¥è¡¨ç¤ºç¨‹åºçŠ¶æ€ã€‚ 



# StateFuzz Design Detail



## çŠ¶æ€å»ºæ¨¡

### çŠ¶æ€å˜é‡

å¦‚ä¹‹å‰æ‰€è¿°

### ç¨‹åºçŠ¶æ€

ç¨‹åºçŠ¶æ€ç†æƒ³æƒ…å†µåº”è¯¥ç”±æ‰€æœ‰çŠ¶æ€å˜é‡ç»„æˆï¼Œä½†ç”±äºæ€§èƒ½é™åˆ¶ï¼Œéœ€è¦å¯¹æ•°é‡è¿›è¡Œä¼˜åŒ–ï¼š

1. åªç”¨ç¨‹åºçŠ¶æ€ä¸­ç›¸å…³çš„çŠ¶æ€å˜é‡å¯¹ï¼Œç±»ä¼¼ä¸AFLé‡Œçš„edgeï¼ˆä¸¤ä¸ªåŸºæœ¬å—å¯¹ï¼‰ï¼Œå¹¶ç”¨å®éªŒæ¥è¯å®è¿™ç§çŒœæƒ³ã€‚è‹¥æ§åˆ¶æµæˆ–å†…å­˜è®¿é—®æŒ‡é’ˆï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰å—åˆ°è¿™ä¸¤ä¸ªå˜é‡çš„å½±å“ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªçŠ¶æ€å˜é‡æ ‡è®°ä¸º**ç›¸å…³**ã€‚ å¦‚ä¸¤ä¸ªå˜é‡åˆ†åˆ«è¢«ä¸¤ä¸ªæ¡ä»¶è¯­å¥æ£€æŸ¥ï¼Œä¸”è¿™ä¸¤ä¸ªæ¡ä»¶å£°æ˜æ˜¯åµŒå¥—çš„ï¼Œåˆ™è®¤ä¸ºè¿™ä¸¤ä¸ªå˜é‡æ˜¯ç›¸å…³çš„ã€‚
2. çŠ¶æ€ç©ºé—´çš„å€¼ç©ºé—´å¾ˆå¤§ï¼Œä½†åªæ¥æ”¶å¤§å°æœ‰é™çš„å€¼ï¼Œæå‡ºå°†å˜é‡å€¼ç©ºé—´åˆ’åˆ†ä¸ºå‡ ä¸ªèŒƒå›´ï¼Œå¹¶Fuzzingè¿‡ç¨‹ä¸­è¿½è¸ªæ˜¯å¦å‘½ä¸­æ¯ä¸ªå€¼èŒƒå›´

## Overview

![image-20220926172535995](StateFuzz.assets/image-20220926172535995.png)

åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šprogram state recognitionã€program instrumentationã€the fuzzing loop.

### Program state recognition

é¦–å…ˆåˆ†æLinuxé©±åŠ¨ç¨‹åºçš„æºä»£ç ï¼Œé€šè¿‡æå–çŠ¶æ€å˜é‡ã€çŠ¶æ€å˜é‡çš„å€¼é€‰æ‹©ä»¥åŠçŠ¶æ€å˜é‡ä¹‹é—´çš„ç›¸å…³æ€§æ¥è¯†åˆ«ç¨‹åºçŠ¶æ€ã€‚

å…·ä½“å°±æ˜¯ï¼Œåˆ©ç”¨é™æ€åˆ†æè¯†åˆ«ç”±ä¸åŒè¾“å…¥é˜¶æ®µè§¦å‘çš„ç¨‹åºæ“ä½œï¼Œå¹¶è¯†åˆ«ç”±å¤šä¸ªç¨‹åºæ“ä½œè®¿é—®çš„å…±äº«å˜é‡ã€‚ä¸ºäº†ä½¿è·Ÿè¸ªçŠ¶æ€å˜é‡åˆ‡å®å¯è¡Œï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥åˆ†æäº†å®ƒä»¬çš„å€¼ï¼ˆæˆ–å€¼èŒƒå›´ï¼‰é€‰æ‹©ã€‚åˆ©ç”¨é™æ€ç¬¦å·æ‰§è¡Œæ¥æ”¶é›†æ¯ä¸ªçŠ¶æ€å˜é‡çš„å€¼çº¦æŸï¼Œå¹¶æ¨æ–­å…¶ä¸ç›¸äº¤çš„å€¼èŒƒå›´ã€‚ 

### program instrumentation

å¯¹ç›®æ ‡ç¨‹åºï¼ˆå³Linuxé©±åŠ¨ç¨‹åºï¼‰è¿›è¡Œæ’æ¡©ï¼Œä»¥è·Ÿè¸ªç¨‹åºçŠ¶æ€è¦†ç›–ç‡ä»¥åŠä»£ç è¦†ç›–ç‡ï¼ˆå¦‚KCOVæä¾›çš„[28]ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œç»™å®šå·²è¯†åˆ«çš„çŠ¶æ€å˜é‡ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ SVF[44] æ‰§è¡Œ alias analysis ï¼ˆåˆ«ååˆ†æï¼‰ï¼Œä»¥è¯†åˆ«çŠ¶æ€å˜é‡çš„åˆ«åã€‚ç„¶ååœ¨ç¼–è¯‘æœŸé—´ï¼ŒStateFuzzæ£€æŸ¥æ¯æ¡å­˜å‚¨æŒ‡ä»¤çš„ç›®æ ‡æŒ‡é’ˆã€‚å¦‚æœç›®æ ‡æŒ‡é’ˆæŒ‡å‘çŠ¶æ€å˜é‡æˆ–çŠ¶æ€å˜é‡çš„åˆ«åï¼Œåˆ™è¯¥æŒ‡ä»¤å°†è¢«æ’æ¡©ä»¥è·Ÿè¸ªè¦å­˜å‚¨çš„å€¼ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒå°†è·Ÿè¸ªå€¼èŒƒå›´è¾¹å’Œæå€¼ï¼Œä»¥ç”Ÿæˆç¨‹åºçŠ¶æ€è¦†ç›–åé¦ˆã€‚ 

### Fuzzing Loop

é€šè¿‡å°†ç¨‹åºçŠ¶æ€åé¦ˆåº”ç”¨äºç§å­ä¿å­˜å’Œç§å­é€‰æ‹©è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ‰©å±•äº†ä»£ç è¦†ç›–ç‡å¼•å¯¼æ¨¡ç³Šå™¨çš„æ¨¡ç³Šå¾ªç¯ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†ä¿ç•™å‘ç°æ–°å€¼èŒƒå›´è¾¹ç¼˜æˆ–çŠ¶æ€å˜é‡æ–°æå€¼çš„è¾“å…¥ï¼Œä»¥åŠå‘ç°æ–°ä»£ç çš„è¾“å…¥ã€‚ç„¶åï¼Œåº”ç”¨ä¸€ç§ç²¾ç»†çš„é€‰æ‹©ç­–ç•¥ï¼Œä»è¿™äº›ä¸åŒç±»å‹çš„ä¿å­˜ç§å­ä¸­é€‰æ‹©å˜å¼‚è¾“å…¥ã€‚

## Program State Recognition

è¿™éƒ¨åˆ†æ˜¯ StateFuzz çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šè¯†åˆ«ç¨‹åºè¡Œä¸ºã€è¯†åˆ«çŠ¶æ€å˜é‡ã€æ¨æ–­çŠ¶æ€å˜é‡å€¼çš„èŒƒå›´ã€‚

![image-20220926210325552](StateFuzz.assets/image-20220926210325552.png)

### Recognize Program Actions

å›¾2ä¸ºç¨‹åºè¡Œä¸ºä¾‹å­ï¼Œä»£ç æ¥è‡ªé©±åŠ¨ hpetã€‚é¦–å…ˆï¼Œè®¸å¤šç¨‹åºæ“ä½œåœ¨å…¨å±€æ“ä½œç»“æ„ä¸­åˆå§‹åŒ–ï¼›å…¶æ¬¡ï¼Œé©±åŠ¨ç¨‹åºå¯ä»¥é€šè¿‡ioctlæ¥å£çš„å­å‘½ä»¤æ‰§è¡Œç¨‹åºæ“ä½œã€‚

åŸºäºLinuxé©±åŠ¨ç¨‹åºä»£ç çš„è¿™äº›çº¦å®šï¼Œæˆ‘ä»¬åˆ©ç”¨é™æ€åˆ†ææ¥è¯†åˆ«ç¨‹åºæ“ä½œã€‚å¯¹äºåŒ…æ‹¬readã€writeã€openã€pollå’Œmmapåœ¨å†…çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬åˆ†æå®ƒä»¬çš„æºä»£ç ä»¥å®šä½å°†å‡½æ•°å¤„ç†ç¨‹åºåˆ†é…ç»™å…¨å±€æ“ä½œç»“æ„çš„åˆå§‹å€¼è®¾å®šé¡¹ã€‚è¿™äº›æŒ‡å®šçš„å‡½æ•°å¤„ç†ç¨‹åºæ˜¯ç¨‹åºæ“ä½œçš„å…¥å£ç‚¹ã€‚å¯¹äºioctlç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬æ‰©å±•äº†å·¥å…·DIFUZE[14]ï¼Œä»¥æ‰§è¡Œè¿‡ç¨‹é—´å’Œè·¯å¾„æ•æ„Ÿåˆ†æï¼Œå¹¶è¯†åˆ«æ‰€æœ‰æ”¯æŒçš„å­å‘½ä»¤ã€‚ä¸æ¯ä¸ªå­å‘½ä»¤å…³è”çš„ä»£ç æ®µæ˜¯ä¸€ä¸ªç¨‹åºæ“ä½œã€‚ 

### Recognize State-variables

ä¸åŒçš„ç¨‹åºæ“ä½œæœ‰æ—¶å¿…é¡»é€šè¿‡çŠ¶æ€å˜é‡æ¥åè°ƒç¨‹åºçŠ¶æ€ã€‚å› æ­¤ï¼ŒçŠ¶æ€å˜é‡é€šå¸¸ç”±å¤šä¸ªç¨‹åºæ“ä½œå…±äº«ã€‚

ä¸ºäº†è¯†åˆ«çŠ¶æ€å˜é‡ï¼ŒåŸºäºCGæ¥åˆ†ææ¯ä¸ªç¨‹åºåŠ¨ä½œçš„ä»£ç ï¼Œå¹¶è¯†åˆ«å…¶è®¿é—®çš„å˜é‡ã€‚å¦‚æœå˜é‡å¯ä»¥å›æº¯åˆ°å…¨å±€å˜é‡æˆ–ç»“æ„å­—æ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æŠŠå®ƒä»¬æ ‡è®°ä¸ºå€™é€‰çŠ¶æ€å˜é‡ï¼Œå› ä¸ºçŠ¶æ€å˜é‡åº”æœ‰é•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚åˆ†æå®Œæ‰€æœ‰ç¨‹åºæ“ä½œåï¼Œè¿‡æ»¤æ‰€æœ‰å€™é€‰çŠ¶æ€å˜é‡ï¼Œåªä¿ç•™é‚£äº›èƒ½è¢«ç¨‹åºæ“ä½œæ›´æ–°å¹¶ç”±å¦ä¸€ä¸ªç¨‹åºæ“ä½œåŠ è½½çš„å€™é€‰çŠ¶æ€å˜é‡ï¼ˆä¸¢å¼ƒé‚£äº›æ²¡æœ‰è¢«ç¨‹åºæ“ä½œè¯»æˆ–å†™çš„å˜é‡ï¼‰ã€‚å¦‚å›¾2ä¸­çš„`devp->hd_ireqfreq` å’Œ `devp->hd_hdwirq` ä¼šè¢«hiè¯†åˆ«ä¸ºçŠ¶æ€å˜é‡ã€‚

### Infer State-variables' Value Ranges

åœ¨æºä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ä¸Šæ‰§è¡Œè¿‡ç¨‹é—´å’Œè·¯å¾„æ•æ„Ÿçš„é™æ€ç¬¦å·æ‰§è¡Œæ¥æ¨æ–­æ¯ä¸ªçŠ¶æ€å˜é‡çš„å€¼èŒƒå›´ã€‚ä¸ºäº†é¿å…è·¯å¾„çˆ†ç‚¸ï¼Œæˆ‘ä»¬çš„ç¬¦å·æ‰§è¡Œä¸€æ¬¡åªåˆ†æä¸€ä¸ªæºä»£ç æ–‡ä»¶ï¼ˆå³æ¨¡å—å†…åˆ†æï¼‰ï¼Œè¿™å¤§å¤§å‡å°‘äº†è·¯å¾„çš„æ•°é‡ã€‚é€šè¿‡ç±»å‹å’Œåç§°åœ¨ASTä¸­å®šä½çŠ¶æ€å˜é‡ ï¼Œç„¶åæ¢ç´¢æ¯ä¸ªç¨‹åºè·¯å¾„ï¼Œå¹¶åœ¨æ¢ç´¢è¿‡ç¨‹ä¸­è¯†åˆ«ä¸çŠ¶æ€å˜é‡ç›¸å…³çš„è·¯å¾„çº¦æŸã€‚å¦‚æœæœ‰ä¸€æ¡è·¯å¾„çš„çº¦æŸæ¶‰åŠè¿™ä¸¤ä¸ªçŠ¶æ€å˜é‡ï¼Œæˆ‘ä»¬å°†ç¡®å®šä¸¤ä¸ªç›¸å…³çš„çŠ¶æ€å˜é‡ã€‚é€šè¿‡çº¦æŸæ±‚è§£å™¨ï¼Œå¯ä»¥æ¨æ–­çŠ¶æ€å˜é‡çš„ä¸´ç•Œå€¼ï¼ˆå°†æ”¹å˜è·¯å¾„çº¦æŸçš„å€¼ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›ä¸´ç•Œå€¼ä½œä¸ºè¾¹ç•Œæ¥åˆ†å‰²çŠ¶æ€å˜é‡çš„å€¼ç©ºé—´ã€‚ 

å¦‚çŠ¶æ€å˜é‡`devp->hd_ireqfreq`å’Œ`devp->hd_hdwirq`åˆ†åˆ«åœ¨ç¬¬9è¡Œå’Œç¬¬11è¡Œä¸­æ£€æŸ¥ä¸º0ã€‚`devp->hd_ireqfreq` ä¼šå¯¼è‡´ä¸¤ä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«å½“ `!=0` å’Œ `==0` æ—¶ã€‚å¯ä»¥å¾—åˆ°ä¸‰ä¸ªè¾¹ç•Œå€¼ -1, 0, 1ã€‚å°†`devp->hd_ireqfreq`çš„å€¼ç©ºé—´åˆ†ä¸º4ä¸ªï¼š[INT_MINï¼Œ-1]ã€ï¼ˆ1,0]ã€ï¼ˆ0,1]ã€ï¼ˆ1ï¼ŒINT_MAX]ã€‚

## Fuzzing Loop

å¯¹é©±åŠ¨æ’æ¡©è¿½è¸ªçŠ¶æ€å˜åŒ–åï¼Œfuzzerè¿›å…¥fuzzingå¾ªç¯ã€‚é‡‡ç”¨é—ä¼ ç®—æ³•å¼•å¯¼fuzzeræ¢ç´¢æ›´å¤šç¨‹åºçŠ¶æ€ï¼Œä¿å­˜å¹¶æ’åºé‚£äº›å‘ç°æ–°ä»£ç æˆ–æ–°çŠ¶æ€çš„ç”¨ä¾‹ã€‚ä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡ä¸‰ç»´åé¦ˆæœºåˆ¶æ¥ä¼˜åŒ–å¼•å¯¼è¿‡ç¨‹ï¼Œç§å­ä¿ç•™å’Œç­›é€‰ç­–ç•¥ã€‚

### Three-dimension Feedback Mechanism

#### ä»£ç è¦†ç›–ç‡

é‡ç”¨Syzkallerç°æœ‰ä»£ç è¦†ç›–åé¦ˆï¼Œè¯¥ç»´åº¦èƒ½å¤Ÿä¿å­˜å‘ç°æ–°ä»£ç çš„ç”¨ä¾‹

#### å€¼èŒƒå›´ ğŸ¤”

åº”ç”¨äº†ä¸€ä¸ªæ–°çš„åé¦ˆå€¼èŒƒå›´åé¦ˆã€‚è‹¥ç”¨ä¾‹è§¦å‘æ–°çš„å€¼èŒƒå›´è¾¹ï¼Œå°±è¡¨ç¤ºè§¦å‘äº†ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œä¼šå‘å‡ºåé¦ˆä¿¡å·ï¼Œæ”¹ä¸ºéƒ½èƒ½å¤Ÿä¿å­˜å‘ç°æ–°ç¨‹åºçŠ¶æ€çš„ç”¨ä¾‹ã€‚ä¸é—ä¼ ç®—æ³•é…åˆä½¿ç”¨æ—¶ï¼Œå¯ä»¥å®ç°æ™ºèƒ½çŠ¶æ€ç©ºé—´æ¢ç´¢ã€‚ 

å¦‚`devp->hd_ireqfreq`å’Œ`devp->hd_hdwirq` éƒ½æœ‰å››ä¸ªå€¼èŒƒå›´ï¼Œå½“`devp->hd_ireqfreq`ä»0å˜ä¸º1ï¼Œå…¶å€¼èŒƒå›´ä» (-1,0] å˜ä¸º (0,1]ã€‚å› æ­¤ï¼Œå°†äº§ç”Ÿè¿™ä¸¤ä¸ªå˜é‡çš„æ–°çš„å€¼èŒƒå›´ã€‚

#### æå€¼ ğŸ¤”

æœ‰æ—¶ç”±äºç¼ºå°‘çº¦æŸæˆ–æ— æ³•æ±‚è§£çš„çº¦æŸï¼Œæ— æ³•è§£ææŸäº›çŠ¶æ€å˜é‡çš„å€¼èŒƒå›´ã€‚å‘ç°ä¸€ä¸ªæ–°çš„æå€¼ä¹Ÿæ„å‘³ç€ç¨‹åºè¿›å…¥ä¸€ä¸ªæ–°çŠ¶æ€ã€‚æˆ‘ä»¬æä¾›äº†å¦ä¸€ä¸ªæ–°çš„åé¦ˆç»´åº¦ï¼Œå¯ä»¥äº¤æ›¿è·Ÿè¸ªçŠ¶æ€å˜é‡çš„æå€¼ã€‚å…·ä½“æ¥è¯´ï¼Œæ¨¡ç³Šå™¨è®°å½•æµ‹è¯•å†å²ä¸­æ¯ä¸ªçŠ¶æ€å˜é‡çš„ä¸Šä¸‹ç•Œï¼Œå¹¶åœ¨æ–°çš„æµ‹è¯•ç”¨ä¾‹å°†çŠ¶æ€å˜é‡è®¾ç½®ä¸ºè¶…å‡ºå…¶è¾¹ç•Œæ—¶å‘å‡ºåé¦ˆä¿¡å·ã€‚åé¦ˆçš„è¿™ä¸ªç»´åº¦ä½¿æ¨¡ç³Šå™¨èƒ½å¤Ÿä¿å­˜è§¦å‘æç«¯å€¼çš„æµ‹è¯•ç”¨ä¾‹ã€‚

### Seed Preservation and Selection Strategy

æ ¹æ®æ¯ä¸ªç§å­è§¦å‘çš„åé¦ˆä¿¡å·ç±»å‹è®¾è®¡äº†ä¸€ä¸ªä¸‰å±‚ç§å­åº“æ¥ä¿å­˜ç§å­ã€‚

#### Seed Preservation

æä¾›ä¸€ä¸ªä¸‰å±‚ç§å­è¯­æ–™åº“åˆ†åˆ«å­˜å‚¨å‘ç°æ–°ä»£ç ã€æ–°å€¼èŒƒå›´è¾¹å’Œæ–°æå€¼çš„ç§å­ã€‚å¦‚æœä¸€ä¸ªç§å­åŒæ—¶è§¦å‘å¤šä¸ªåé¦ˆï¼Œé‚£ä¹ˆå®ƒå¯ä»¥å­˜å‚¨åœ¨å¤šä¸ªå±‚ä¸­ã€‚ 

æœ‰æ—¶å‘ç°æ–°å€¼èŒƒå›´è¾¹ä½†æ‰§è¡Œç±»ä¼¼ä»£ç çš„ç§å­å¯èƒ½ä¼šå¡«æ»¡é˜Ÿåˆ—ï¼Œä»è€Œé˜»æ­¢æ¨¡ç³Šå™¨æ¢ç´¢å…¶ä»–ä»£ç ã€‚ä¸ºäº†å‡å°‘è¿™ç§å±€éƒ¨æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨ç§å­çš„è·¯å¾„å¯¹ç§å­è¿›è¡Œèšç±»ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ä»…è°ƒåº¦ç§å­ï¼Œè¿˜è°ƒåº¦åæœŸç§å­é€‰æ‹©é˜¶æ®µçš„èšç±»ï¼ˆå¦‚bucketï¼‰ã€‚ 

```
--------------------------------------------------------------------------
 Algorithm 1 Seed Preservation Algorithm
--------------------------------------------------------------------------
Input: s, the test case to be processed
Output: T1, tier 1 of corpus to store seeds discover new code edges
Output: T2, tier 2 of corpus to store seeds discover new value-range edges
Output: T3, tier 3 of corpus to store seeds discover new extreme values

	T1 = T3 = [ ], T2 = { }
	coverage, cfgPathHash â† execute(s)
	if findNewCode(coverage) then
		T1 â† T1 âˆª {s}
	end if
	if findNewValueRangeEdge(coverage) then
		if cfgPathHash IN T2 then
			T2[cfgPathHash] â† T2[cfgPathHash] âˆª {s}
		else
			T2[cfgPathHash] = /0
			T2[cfgPathHash] â† T2[cfgPathHash] âˆª {s}
		end if
	end if
	if findNewExtremum(coverage) then
		T3 â† T3 âˆª {s}
		T3 â† minimize(T3)
	end if
------------------------------------------------------------------------------
```

é¦–å…ˆï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹å‘ç°äº†æ–°ä»£ç ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°ç§å­è¯­æ–™åº“çš„ç¬¬1å±‚ã€‚

å…¶æ¬¡ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹å‘ç°äº†æ–°çš„å€¼èŒƒå›´è¾¹ï¼ŒStateFuzzä¼šå°†æµ‹è¯•ç”¨ä¾‹æ·»åŠ åˆ°Tier-2ä¸­çš„ç‰¹å®šbucketä¸­ï¼Œè¯¥bucketç”±æ‰§è¡Œçš„åŸºæœ¬å—åœ°å€çš„æ•£åˆ—ç´¢å¼•ã€‚å¦‚æœè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è·¯å¾„å¯¹StateFuzzæ¥è¯´æ˜¯æ–°çš„ï¼Œé‚£ä¹ˆStateFuzzä¼šåœ¨Tier-2ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„bucketï¼Œå¹¶å­˜å‚¨è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¦åˆ™ï¼Œå®ƒä¼šå°†è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å­˜å‚¨åœ¨ä¸€ä¸ªç°æœ‰bucketä¸­ã€‚

ç¬¬ä¸‰ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹å‘ç°äº†æ–°çš„æå€¼ï¼Œå®ƒå°†è¢«æ·»åŠ åˆ°ç§å­è¯­æ–™åº“çš„ç¬¬ä¸‰å±‚ã€‚ç„¶åStateFuzzæ›´æ–°æå€¼è®°å½•ï¼Œå¹¶åˆ é™¤ä»¥å‰å‘ç°è¿‡æœŸæå€¼çš„ç§å­ï¼Œä»¥æœ€å°åŒ–è¯­æ–™åº“ã€‚ ç”±äºæœ€å°åŒ–æœºåˆ¶ï¼Œç¬¬ä¸‰å±‚ä¸­çš„ç§å­æ•°é‡ä¸æ˜¯å¾ˆå¤§ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨æ¡¶æ¥èšç±»ç§å­ã€‚

#### Seed Selection

```
-----------------------------------------------------------------------------
Algorithm 2 Seed Selection Algorithm
-----------------------------------------------------------------------------
Input: T1, tier 1 of corpus to store seeds discover new code edges
Input: T2, tier 2 of corpus to store seeds discover new value-range edges
Input: T3, tier 3 of corpus to store seeds discover new extreme values
Output: s, the selected seed

Pr = 3, Pc = 3 # predefined probability hyper-parameters
r = randInt(Pr*Pc) # generate a integer in [0, Pr*Pc) randomly
if r < Pr then
	# with probability 1/Pc
	s â† T1[ randInt() % len(T1) ]
else if r < Pr+Pc then
	# with probability 1/Pr
	keys â† getMapKeys(T2)
	pathHash â† keys[ randInt() % len(keys) ]
	bucket â† T2[pathHash]
	s â† bucket[ randInt() % len(bucket) ]
else
	# with probability 1-1/Pr-1/Pc
	s â† T3[ randInt() % len(T3) ]
end if
---------------------------------------------------------------------------------
```

StateFuzzæ ¹æ®é¢„å®šä¹‰çš„æ¦‚ç‡è¶…å‚æ•°$P_r$å’Œ$P_c$é€‰æ‹©ç§å­è¯­æ–™åº“çš„ä¸€å±‚ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åªè®©ä¸‰å±‚è¯­æ–™åº“å…·æœ‰ç›¸åŒçš„è¢«é€‰æ‹©æ¦‚ç‡ï¼ˆå³Pr=3å’ŒPc=3ï¼‰ã€‚

ä¹‹åä»é€‰å®šçš„Tierä¸­é€‰æ‹©ä¸€ä¸ªç§å­ã€‚å¦‚æœé€‰æ‹©äº†Tier-1æˆ–Tier-3ï¼ŒStateFuzzä¼šä»å±‚ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç§å­è¿›è¡Œè¿›ä¸€æ­¥çªå˜ã€‚å¦‚æœé€‰æ‹©äº†Tier-2ï¼ŒStateFuzzé¦–å…ˆä»è¯¥å±‚éšæœºé€‰æ‹©ä¸€ä¸ªbucketï¼Œç„¶åä»è¯¥bucketä¸­é€‰æ‹©ä¸€ä¸ªéšæœºç§å­è¿›è¡Œè¿›ä¸€æ­¥çš„å˜å¼‚ã€‚ ä¸åŒçš„bucketå¯èƒ½ä¼šè·å¾—ç›¸åŒçš„é€‰æ‹©æœºä¼šï¼Œé¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜è§£çš„æƒ…å†µã€‚æ¯ä¸ªbucketä»£è¡¨ä¸€æ¡æ§åˆ¶æµè·¯å¾„ï¼Œå› æ­¤æ­¤ç§å­é€‰æ‹©ç­–ç•¥å°†ç¡®ä¿å½»åº•æ¢ç´¢ä¸åŒçš„è·¯å¾„ã€‚åœ¨æ¯ä¸ªbucketä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªç§å­è§¦å‘ä¸åŒçš„çŠ¶æ€ã€‚å½“é€‰æ‹©æ­¤å­˜å‚¨bucketæ—¶ï¼Œæ­¤ç§å­é€‰æ‹©ç­–ç•¥å°†å°è¯•æ¢ç´¢ä¸åŒçš„çŠ¶æ€ã€‚ 

# Implementation

â€‹                                                              **Table 2: Implementation details of StateFuzz.**

| Component         | Tool              | Lines of Code   |
| ----------------- | ----------------- | --------------- |
| State Recognition | DIFUZE, CRIX, CSA | #2,500 (C++)    |
| Instrumentation   | LLVM Sancov, SVF  | #500 (C++)      |
| Fuzzing Loop      | Syzkaller         | #3,800 (Go)     |
| Glue scripts      | -                 | #1,000 (Python) |
| total             |                   | #7,800          |

å¯¹åº”ä»¥ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šè¯†åˆ«ç¨‹åºçŠ¶æ€ã€ç¨‹åºæ’æ¡©ã€fuzzingå¾ªç¯

 åœ¨ç¬¬ä¸€ä¸ªç»„ä»¶ä¸­ï¼ŒStateFuzzä½¿ç”¨DIFUZE[14]çš„ä¿®æ”¹ç‰ˆæœ¬æ¥è¯†åˆ«é©±åŠ¨ç¨‹åºçš„æ“ä½œã€‚æ­¤å¤–ï¼Œå®ƒé€šè¿‡LLVMè¿‡ç¨‹è¯†åˆ«ç”±ä¸åŒç¨‹åºæ“ä½œå…±äº«å’Œè®¿é—®çš„çŠ¶æ€å˜é‡ï¼Œå…¶ä¸­åˆ©ç”¨CRIX[13]çš„ä¸¤å±‚åŸºäºç±»å‹çš„é—´æ¥è°ƒç”¨åˆ†ææ¥æ„å»ºè°ƒç”¨å›¾ã€‚å®ƒæ”¶é›†çŠ¶æ€å˜é‡çº¦æŸï¼Œå¹¶é€šè¿‡Clang  static Analyzerï¼ˆCSAï¼‰[1]é€šè¿‡æ¨¡å—å†…é™æ€ç¬¦å·æ‰§è¡Œæ¨æ–­æ¯ä¸ªçŠ¶æ€å˜é‡çš„å€¼èŒƒå›´ã€‚ 

åœ¨ç¬¬äºŒä¸ªç»„ä»¶ä¸­ï¼Œä¸ºäº†æ›´ç²¾ç¡®åœ°è·Ÿè¸ªçŠ¶æ€å˜é‡ï¼ŒStateFuzzä½¿ç”¨æ±¡ç‚¹åˆ†æå·¥å…·SVFæŸ¥æ‰¾çŠ¶æ€å˜é‡çš„åˆ«åï¼Œå¹¶è·Ÿè¸ªå¯¹è¿™äº›åˆ«åçš„è®¿é—®ã€‚æˆ‘ä»¬ç”¨åç§°ï¼ˆå¯¹äºä¸å±äºç»“æ„ç±»å‹çš„å…¨å±€å˜é‡ï¼‰æˆ–å…¶ç±»å‹ï¼ˆå¯¹äºç»“æ„å­—æ®µï¼‰è€Œä¸æ˜¯ç‰¹å®šæŒ‡é’ˆæ¥æ ‡è®°çŠ¶æ€å˜é‡ï¼Œè¿™æ˜¯ä¸€ç§ä¿å®ˆçš„è§£å†³æ–¹æ¡ˆï¼Œä¸éœ€è¦å¤æ‚çš„æŒ‡é’ˆåˆ†æã€‚æˆ‘ä»¬åˆ©ç”¨SVFæŸ¥æ‰¾æ— æ³•é€šè¿‡åç§°æˆ–ç±»å‹è¯†åˆ«çš„çŠ¶æ€å˜é‡åˆ«åï¼Œä½œä¸ºçŠ¶æ€å˜é‡çš„è¡¥å……ã€‚æ‰€æœ‰è¦†ç›–èŒƒå›´å’Œç¨‹åºçŠ¶æ€è·Ÿè¸ªæŒ‡ä»¤éƒ½ä½¿ç”¨LLVM  SanCovè¿›è¡Œæ£€æµ‹ã€‚ 

ä¸ºäº†è·Ÿè¸ªçŠ¶æ€ï¼ŒStateFuzzä½¿ç”¨ç›®æ ‡ç¨‹åºè·Ÿè¸ªçŠ¶æ€å˜é‡çš„å€¼ã€‚åœ¨ç¼–è¯‘æœŸé—´ï¼Œå¦‚æœç›®æ ‡æŒ‡é’ˆæŒ‡å‘çŠ¶æ€å˜é‡æˆ–å…¶åˆ«åï¼Œåˆ™StateFuzzä¼šåœ¨æ¯æ¡å­˜å‚¨æŒ‡ä»¤åæ’å…¥è·Ÿè¸ªä»£ç ã€‚ å¯¹äºé€šè¿‡è°ƒç”¨å†…å­˜å¤åˆ¶å‡½æ•°ï¼ˆå¦‚copy_from_userå’Œmemcpyï¼‰å†™å…¥çŠ¶æ€å˜é‡çš„æ“ä½œï¼Œè§£æè¿™äº›å‡½æ•°çš„ç›®æ ‡å†…å­˜ç±»å‹ï¼Œä»¥æ ¹æ®ç±»å‹æ£€æŸ¥ç›®æ ‡å†…å­˜ä¸­æ˜¯å¦åŒ…å«çŠ¶æ€å˜é‡ã€‚

ç¬¬ä¸‰ä¸ªç»„ä»¶åŸºäºç°æœ‰çš„å†…æ ¸æ¨¡ç³Šå¼•æ“Syzkallerã€‚ä¸Syzkallerç±»ä¼¼ï¼ŒStateFuzzä½¿ç”¨ä¸‰ä¸ªå­—å…¸æ¥å­˜å‚¨ä¸‰ç»´çš„è¦†ç›–ç‡ã€‚å¯¹äºå€¼èŒƒå›´ç»´åº¦ï¼Œæˆ‘ä»¬å°†çŠ¶æ€å˜é‡IDå’Œå‘½ä¸­èŒƒå›´IDæ‹¼æ¥ä¸ºçŠ¶æ€å˜é‡çš„å€¼èŒƒå›´å•ä½ã€‚ç„¶åï¼Œå¯¹äºç›¸å…³çŠ¶æ€å˜é‡å¯¹ä¸­çš„ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬è®¡ç®—å…¶å€¼èŒƒå›´å•ä½çš„å“ˆå¸Œå€¼ï¼ˆå³ä¸¤ä¸ªå•ä½çš„å“ˆå¸Œå€¼ï¼‰ï¼Œä»¥è¡¨ç¤ºå€¼èŒƒå›´è¾¹ç¼˜ã€‚å­—å…¸é”®æ˜¯å€¼èŒƒå›´è¾¹ï¼Œå€¼æ˜¯è¾¹çš„å‘½ä¸­æ¬¡æ•°ã€‚å¯¹äºæå€¼ç»´åº¦ï¼Œå­—å…¸é”®æ˜¯çŠ¶æ€å˜é‡IDï¼Œå­—å…¸å€¼æ˜¯å®ƒä»¬çš„æå€¼ã€‚

# Evaluation

å®éªŒä¸»è¦å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š
â€¢ **RQ1: Are the state representation expressive and meaning-ful? Is there any state explosion issue? (Section 5.2)**
**â€¢ RQ2: Can StateFuzz explore more states than existing approaches? (Section 5.3)**
**â€¢ RQ3: Can StateFuzz achieve higher code coverage than other existing approaches? (Section 5.4)**
**â€¢ RQ4: Can StateFuzz discover vulnerabilities in Linux drivers? (Section 5.5)**
**â€¢ RQ5: How do different feedback dimensions affect StateFuzzâ€™s performance? (Section 5.6)**

## Setup

ç¬¬ä¸€ä¸ªå®éªŒï¼Œåœ¨æœåŠ¡å™¨ä¸Šç”¨QEMUæ¨¡æ‹Ÿæµ‹è¯•`kernel v4.19`ï¼Œå¯¹äºSyzkallerå’ŒStateFuzzï¼Œæˆ‘ä»¬åˆ†åˆ«ä¸ºå®ƒä»¬åˆ†é…äº†8ä¸ªVMï¼Œæ¯ä¸ªVMæœ‰ä¸¤ä¸ªvCPUï¼ˆå³åˆ†é…äº†16ä¸ªvCPUï¼‰ã€‚ å¯¹äºSyzkallerå’ŒStateFuzzï¼Œæˆ‘ä»¬åˆ†åˆ«ä¸ºå®ƒä»¬åˆ†é…äº†8ä¸ªVMï¼Œæ¯ä¸ªVMæœ‰ä¸¤ä¸ªvCPUï¼ˆå³åˆ†é…äº†16ä¸ªvCPUï¼‰ã€‚ 

ç¬¬äºŒä¸ªå®éªŒï¼Œåœ¨Pixel-4æ‰‹æœºä¸Šæµ‹è¯•`MSM-4.14 kernel`ã€‚MSM-4.14ä¸­çš„è®¸å¤šè®¾å¤‡é©±åŠ¨ç¨‹åºä¾èµ–äºQEMUæ— æ³•æ¨¡æ‹Ÿçš„çœŸå®ç”µè¯å¤–å›´è®¾å¤‡ï¼Œä»è€Œé˜»æ­¢äº†MSMå†…æ ¸åœ¨QEMUä¸Šå¯åŠ¨ã€‚æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ‰‹æœºæ¨¡ç³ŠåŒ–ï¼š

1. æŒ‰ç…§Androidè°ƒè¯•æ–‡æ¡£çš„æŒ‡ç¤ºä¸ºæ‰‹æœºæ„å»ºå’Œé—ªå­˜é•œåƒ5ï¼Œ
2. åœ¨æ‰‹æœºä¸Šç”Ÿæˆå’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ˆå³è¿è¡Œsyz fuzzerå’Œsyz  executorï¼‰ï¼Œ
3. åœ¨é€šè¿‡USBè°ƒè¯•è¿æ¥åˆ°æ‰‹æœºçš„PCæœºä¸Šç›‘è§†æ¨¡ç³Šå™¨ï¼ˆå³è¿è¡Œsyz managerï¼‰ï¼ŒæŒ‰ç…§Syzkalleræ–‡æ¡£6çš„æŒ‡ç¤ºã€‚PCæœºè¿è¡ŒUbuntu 18.04 LTS

åœ¨è¿™ä¸¤ç§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨LLVMç¼–è¯‘å†…æ ¸ï¼Œå¹¶å¯ç”¨`KCOV`å’Œ`KCOV_ENABLE_COMPARISONS`æ¥æ”¶é›†ä»£ç è¦†ç›–ç‡ï¼Œå¼€å¯`KASAN`æ£€æµ‹è¿è¡Œä¸­çš„bugã€‚å®éªŒä¸­æ¶‰åŠçš„æ‰€æœ‰Fuzzeréƒ½åº”ç”¨`DIFUZE`ç”Ÿæˆçš„ç›¸åŒç³»ç»Ÿè°ƒç”¨æ¨¡æ¿ï¼Œåªæœ‰`DIFUZ`æå–çš„ç³»ç»Ÿè°ƒç”¨æ‰èƒ½è¿›è¡Œæ¨¡ç³ŠåŒ–ã€‚ä¸ºäº†åŒºåˆ«äºSyzkallerå’ŒHFLçš„åŸå§‹ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨`Syzkallar-D`å’Œ`HFL-D`åˆ†åˆ«æŒ‡åŸå§‹Syzkaleråº”ç”¨DIFUZEç³»ç»Ÿè°ƒç”¨æ¨¡æ¿å’ŒåŸå§‹HFLåº”ç”¨DIFUZEç³»ç»Ÿè°ƒç”¨æ¨¡æ¿ã€‚æ‰€æœ‰Fuzzeréƒ½æ˜¯ç”¨ç©ºçš„åˆå§‹ç§å­è¿è¡Œçš„ã€‚

Linux upstream kernel è·‘48å°æ—¶ï¼Œå°† MSM kernel è·‘72å°æ—¶ï¼Œæ‰€æœ‰æ¨¡ç³Šæ—¶é—´é¢„ç®—éƒ½ä¸åŒ…æ‹¬ç”¨äºå»ºç«‹çŠ¶æ€æ¨¡å‹çš„æ—¶é—´ã€‚ä¸ºäº†å‡å°‘åå·®ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å®éªŒé‡å¤ä¸‰æ¬¡ã€‚ 

## State Model Evaluation (RQ1)
